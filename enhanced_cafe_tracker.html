
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Café Tracker</title>
  <style>
    :root {
      --bg-light: #f0f2f5;
      --bg-dark: #1e1e1e;
      --text-light: #111;
      --text-dark: #f5f5f5;
      --card-light: #fff;
      --card-dark: #2c2c2c;
    }
    body {
      margin: 0;
      padding: 2rem;
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: 0.3s ease all;
      max-width: 720px;
      margin-inline: auto;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    h1 {
      text-align: center;
    }
    #controls {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s ease background;
    }
    #theme-toggle { background: #444; color: #fff; }
    #reset-btn { background: #c62828; color: #fff; }
    #add-btn { background: #0077cc; color: #fff; }
    ul { list-style: none; padding: 0; margin: 0; }
    li {
      background: var(--card-light);
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: transform 0.2s ease;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    body.dark li { background: var(--card-dark); }
    li:hover { transform: scale(1.01); }
    .row { display: flex; justify-content: space-between; align-items: center; }
    .row span { flex: 1; margin-left: 0.5rem; }
    textarea {
      width: 100%;
      resize: vertical;
      min-height: 40px;
      border-radius: 6px;
      padding: 0.5rem;
    }
    .stats-card {
      position: sticky;
      top: 1rem;
      background: #0077cc;
      color: white;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="controls">
    <input type="text" id="search" placeholder="Search cafés..." />
    <button id="theme-toggle">Toggle Theme</button>
    <button id="reset-btn">Reset</button>
  </div>

  <div class="stats-card" id="statsCard">Loading stats...</div>

  <div id="new-item" style="display:flex;gap:1rem;margin-bottom:1rem;">
    <input type="text" id="cafeInput" placeholder="Add new café..." />
    <button id="add-btn">Add</button>
  </div>

  <ul id="cafeList"></ul>

  <script>
    const list = document.getElementById('cafeList');
    const input = document.getElementById('cafeInput');
    const addBtn = document.getElementById('add-btn');
    const themeToggle = document.getElementById('theme-toggle');
    const resetBtn = document.getElementById('reset-btn');
    const searchBar = document.getElementById('search');
    const statsCard = document.getElementById('statsCard');

    const getCafes = () => JSON.parse(localStorage.getItem('cafes') || '[]');
    const saveCafes = (cafes) => localStorage.setItem('cafes', JSON.stringify(cafes));
    const updateStats = () => {
      const cafes = getCafes();
      const total = cafes.length;
      const visited = cafes.filter(c => c.checked).length;
      const favs = cafes.filter(c => c.favorite).length;
      statsCard.textContent = `You've visited ${visited} of ${total} cafés. ★ ${favs} favorite${favs !== 1 ? 's' : ''}`;
    };

    const renderCafes = () => {
      const cafes = getCafes();
      const query = searchBar.value.toLowerCase();
      list.innerHTML = '';
      cafes.forEach((cafe, index) => {
        if (!cafe.name.toLowerCase().includes(query)) return;

        const li = document.createElement('li');
        li.draggable = true;

        const row = document.createElement('div');
        row.className = 'row';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = cafe.checked;

        const nameSpan = document.createElement('span');
        nameSpan.textContent = cafe.name;

        const favBtn = document.createElement('button');
        favBtn.textContent = cafe.favorite ? '★' : '☆';

        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.style.background = '#e53935';
        delBtn.style.color = '#fff';

        row.append(checkbox, nameSpan, favBtn, delBtn);

        const notes = document.createElement('textarea');
        notes.placeholder = 'Notes...';
        notes.value = cafe.notes || '';

        const date = document.createElement('input');
        date.type = 'date';
        date.value = cafe.date || '';

        li.append(row, date, notes);
        list.appendChild(li);

        checkbox.onchange = () => {
          cafes[index].checked = checkbox.checked;
          saveCafes(cafes); renderCafes();
        };
        favBtn.onclick = () => {
          cafes[index].favorite = !cafes[index].favorite;
          saveCafes(cafes); renderCafes();
        };
        delBtn.onclick = () => {
          cafes.splice(index, 1);
          saveCafes(cafes); renderCafes();
        };
        notes.oninput = () => {
          cafes[index].notes = notes.value;
          saveCafes(cafes);
        };
        date.onchange = () => {
          cafes[index].date = date.value;
          saveCafes(cafes);
        };

        li.ondragstart = (e) => e.dataTransfer.setData('text/plain', index);
        li.ondragover = (e) => e.preventDefault();
        li.ondrop = (e) => {
          const from = +e.dataTransfer.getData('text/plain');
          const to = index;
          const dragged = cafes.splice(from, 1)[0];
          cafes.splice(to, 0, dragged);
          saveCafes(cafes); renderCafes();
        };
      });
      updateStats();
    };

    addBtn.onclick = () => {
      const name = input.value.trim();
      if (!name) return;
      const cafes = getCafes();
      cafes.push({ name, checked: false, date: '', notes: '', favorite: false });
      saveCafes(cafes);
      input.value = '';
      renderCafes();
    };

    resetBtn.onclick = () => {
      if (confirm('Clear all cafés?')) {
        localStorage.removeItem('cafes');
        renderCafes();
      }
    };

    searchBar.oninput = renderCafes;

    themeToggle.onclick = () => {
      const isDark = document.body.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    };

    // Theme preference
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
    }

    if (!localStorage.getItem('cafes')) {
      const defaults = [
        "Sihi", "Leaven", "Bella Italiano", "Tao Bao", "Swadeshi", "Jini’s", "Sorrento",
        "Malgudi Coffee Shop", "Minimal", "Pizzaiolo", "Atmosphere", "Sutra Bistro",
        "Zlash", "Starbucks", "Folki", "Firangi Grubs", "Brioche Dorée", "Sapa",
        "White Teak", "Mile High Roasters", "Vui Coffee", "Hideaway", "BigCup",
        "Tusk", "Iconic", "Bonsai Cafe"
      ].map(name => ({ name, checked: false, date: '', notes: '', favorite: false }));
      saveCafes(defaults);
    }

    renderCafes();
  </script>
</body>
</html>
